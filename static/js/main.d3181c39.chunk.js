(window["webpackJsonpmore-podcasts"]=window["webpackJsonpmore-podcasts"]||[]).push([[0],{145:function(e,t){},258:function(e,t,n){e.exports=n(597)},268:function(e,t,n){},269:function(e,t,n){},596:function(e,t,n){},597:function(e,t,n){"use strict";n.r(t);var s=n(0),i=n.n(s),a=n(22),r=n.n(a),o=(n(268),n(3)),l=n(4),c=n(24),u=n(23),h=n(25),d=(n(269),n(99)),m=n.n(d),p=n(66),y=n.n(p),f=n(83),g=n.n(f),v=n(2),I=n.n(v),b=function(){function e(t){Object(o.a)(this,e),this._av=t,this._cancelTokenCreds=I.a.subscribe("ui.getCredentials.request",this._authRequest.bind(this,!1)),this._cancelTokenNewPass=I.a.subscribe("ui.getNewPassword.request",this._authRequest.bind(this,!0))}return Object(l.a)(e,[{key:"finalize",value:function(){I.a.unsubscribe(this._cancelTokenCreds),delete this._cancelTokenCreds,I.a.unsubscribe(this._cancelTokenNewPass),delete this._cancelTokenNewPass,delete this._av}},{key:"_authRequest",value:function(e,t,n){this._currentRequest={topic:t,data:n,passwordOnly:e},this._av.passwordOnly=e,this._av.username="",this._av.password="",this._av.open=!0}},{key:"credentialsObtained",value:function(){this._av.open=!1,this._currentRequest.passwordOnly?I.a.publish("ui.getNewPassword.response.".concat(this._currentRequest.topic.split(".")[3]),{newPassword:this._av.password}):I.a.publish("ui.getCredentials.response.".concat(this._currentRequest.topic.split(".")[3]),{username:this._av.username,password:this._av.password}),delete this._currentRequest}}]),e}(),_=function(e){function t(){var e,n;Object(o.a)(this,t);for(var s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={open:!1,user:"",pass:"",passwordOnly:!1},n.handleClose=function(){n._pres.credentialsObtained()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e,t){var n={};n[e]=t.target.value,this.setState(n)}},{key:"componentDidMount",value:function(){this._pres=new b(this)}},{key:"componentWillUnmount",value:function(){this._pres.finalize()}},{key:"render",value:function(){var e=[i.a.createElement(y.a,{label:"Submit",primary:!0,keyboardFocused:!0,onClick:this.handleClose})],t=i.a.createElement(g.a,{id:"usernameField",hintText:"username",floatingLabelText:"username",fullWidth:!0,value:this.state.user,onChange:this.handleChange.bind(this,"user")}),n=i.a.createElement("p",null,"the new password needs to contain at least 8 characters with one letter in lower case, one letter in upper case, one digit, and one punctuation mark.");return i.a.createElement("div",null,i.a.createElement(m.a,{actions:e,modal:!0,open:this.state.open,onRequestClose:this.handleClose,autoScrollBodyContent:!0},this.state.passwordOnly?n:t,i.a.createElement(g.a,{id:"passwordField",hintText:this.state.passwordOnly?"new password":"password",floatingLabelText:this.state.passwordOnly?"new password":"password",type:"password",fullWidth:!0,value:this.state.pass,onChange:this.handleChange.bind(this,"pass")})))}},{key:"open",set:function(e){this.setState({open:e})}},{key:"passwordOnly",set:function(e){this.setState({passwordOnly:e})}},{key:"username",set:function(e){this.setState({username:e})},get:function(){return this.state.user}},{key:"password",set:function(e){this.setState({password:e})},get:function(){return this.state.pass}}]),t}(i.a.Component),k=n(237),C=n.n(k),w=function(){function e(t){Object(o.a)(this,e),this._view=t,this._notifications=[],this._regToken=e.ps.sub("user.notification.showError",this.showError.bind(this)),this.showNextMessage()}return Object(l.a)(e,[{key:"showError",value:function(e,t){var n="an error occured";t&&t.error&&t.error.message&&(n=t.error.message),this._notifications.push(n),this.showNextMessage()}},{key:"showNextMessage",value:function(){this._view&&(this._showingMessage||0!==this._notifications.length&&(this._showingMessage=!0,this._view.message=this._notifications.shift(),this._view.show=!0,setTimeout(this.timeoutCallback.bind(this),2e3)))}},{key:"timeoutCallback",value:function(){this._view.show=!1,this._showingMessage=!1,this.showNextMessage()}},{key:"finalize",value:function(){var t=this._regToken;delete this._regToken,t&&e.ps.unsub(t)}}]),e}(),E=function(e){function t(){var e,n;Object(o.a)(this,t);for(var s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={message:"",show:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this._pres=new w(this)}},{key:"componentWillUnmount",value:function(){this._pres.finalize()}},{key:"render",value:function(){return i.a.createElement(C.a,{open:this.state.show,message:this.state.message})}},{key:"show",set:function(e){this.setState({show:e})}},{key:"message",set:function(e){this.setState({message:e})}}]),t}(s.Component),T=n(238),S=n.n(T),O=n(148),B=n.n(O),P=n(65),D=B()({palette:{primary1Color:P.lightGreen800,accent1Color:P.deepOrangeA400}}),j=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement(S.a,{muiTheme:D},i.a.createElement("div",null,i.a.createElement(_,null),this.props.children,i.a.createElement(E,null)))}}]),t}(s.Component),A=n(18),U=n(239),q=n.n(U),F=n(82),x=n.n(F);function L(e,t){return new Promise(function(e,t,n,s){var i=x()(),a=I.a.subscribe("".concat(e,".response.").concat(i),function(e,t){I.a.unsubscribe(a),t&&t.error?s(t.error):n(t)});I.a.publish("".concat(e,".request.").concat(i),t)}.bind(null,e,t))}var N=function(){function e(t){Object(o.a)(this,e),this._view=t,this._updateChannels()}return Object(l.a)(e,[{key:"_updateChannels",value:function(){var e=this;return L("system.getAllChannels").then(function(t){t.channels.sort(function(e,t){return e.title.localeCompare(t.title)}),e._view.allChannels=t.channels,e._view.selectedChannels=t.channels.filter(function(e){return e.selected})})}},{key:"goToPlayerPage",value:function(){I.a.publish("system.goToPlayerPage.request")}},{key:"goToInfoPage",value:function(){I.a.publish("system.goToInfoPage.request")}},{key:"addNewChannel",value:function(e){var t=this;L("system.postNewApiChannel",{url:e}).then(function(e){return t._view.newChannelUrl="",L("system.getApiChannelById",e)}).then(function(e){return e.channel.selected=!0,L("system.addOrUpdateChannel",{channel:e.channel})}).then(function(){t._updateChannels()})}},{key:"updateChannelSelection",value:function(e,t){var n=this;L("system.getChannelById",{id:e}).then(function(e){return e.channel.selected=t,L("system.addOrUpdateChannel",e)}).then(function(){return n._updateChannels()})}},{key:"showChannel",value:function(e){I.a.publish("system.goToChannelPage.request",{id:e})}},{key:"finalize",value:function(){delete this._view}}]),e}(),R=n(100),z=n(46),M=n.n(z),Q=n(40),W=n.n(Q),V=n(28),J=n.n(V),G=n(26),Y=n.n(G),H=n(52),K=n.n(H),$=n(53),X=n.n($),Z=function(e){function t(){var e,n;Object(o.a)(this,t);for(var s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={selectedChannels:[],allChannels:[],newChannelUrl:"",showAddChannelDialog:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this._pres=new N(this)}},{key:"componentWillUnmount",value:function(){this._pres.finalize()}},{key:"_handleNewChannelUrl",value:function(e){this.setState({newChannelUrl:e.target.value})}},{key:"_addNewChannel",value:function(){this.state.newChannelUrl&&this._pres.addNewChannel(this.state.newChannelUrl),this.setState({showAddChannelDialog:!1,newChannelUrl:""})}},{key:"_handleChannelSelectChange",value:function(e,t){this._pres.updateChannelSelection(e.target.value,t)}},{key:"_handleListItemClick",value:function(e){this._pres.showChannel(e)}},{key:"render",value:function(){var e=this,t=i.a.createElement(W.a,{iconButtonElement:i.a.createElement(Y.a,null,i.a.createElement(K.a,{color:"#FFF"})),anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"}},i.a.createElement(J.a,{primaryText:"player",onClick:function(){e._pres.goToPlayerPage()}}),i.a.createElement(J.a,{primaryText:"info",onClick:function(){e._pres.goToInfoPage()}})),n=i.a.createElement(W.a,{iconButtonElement:i.a.createElement(Y.a,null,i.a.createElement(X.a,{color:"#FFF"})),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"}},i.a.createElement(J.a,{primaryText:"add channel",onClick:function(){e.setState({newChannelUrl:"",showAddChannelDialog:!0})}})),s=[i.a.createElement(y.a,{label:"Cancel",primary:!0,onClick:function(){e.setState({showAddChannelDialog:!1})}}),i.a.createElement(y.a,{label:"Submit",primary:!0,keyboardFocused:!0,onClick:this._addNewChannel.bind(this)})];return i.a.createElement("div",null,i.a.createElement(M.a,{title:"channels",iconElementLeft:t,iconElementRight:n}),i.a.createElement(m.a,{actions:s,modal:!1,open:this.state.showAddChannelDialog,onRequestClose:function(){e.setState({showAddChannelDialog:!1})}},i.a.createElement(g.a,{value:this.state.newChannelUrl,floatingLabelText:"new channel URL",onChange:this._handleNewChannelUrl.bind(this)})),i.a.createElement(R.Tabs,null,i.a.createElement(R.Tab,{label:"selected"},i.a.createElement(A.List,null,this.state.selectedChannels.map(function(t){return i.a.createElement(A.ListItem,{key:t.id,value:t.id,primaryText:t.title,secondaryText:t.description,onClick:e._handleListItemClick.bind(e,t.id)})}))),i.a.createElement(R.Tab,{label:"all"},i.a.createElement(A.List,null,this.state.allChannels.map(function(t){return i.a.createElement(A.ListItem,{leftCheckbox:i.a.createElement(q.a,{checked:t.selected,onCheck:e._handleChannelSelectChange.bind(e),value:t.id}),key:t.id,primaryText:t.title,secondaryText:t.description})})))))}},{key:"newChannelUrl",set:function(e){this.setState({newChannelUrl:e})}},{key:"selectedChannels",set:function(e){this.setState({selectedChannels:e})}},{key:"allChannels",set:function(e){this.setState({allChannels:e})}}]),t}(s.Component),ee=function(){function e(t){Object(o.a)(this,e),this._view=t,this._updateState()}return Object(l.a)(e,[{key:"goToChannelListPage",value:function(){I.a.publish("system.goToChannelListPage.request")}},{key:"removeDownload",value:function(e,t){var n=this;return L("system.removeEnclosureDocAndBinaryByChannelItemId",{channelId:e,itemId:t}).then(function(){return n._updateState()})}},{key:"refreshDownload",value:function(e,t){var n=this;return L("system.removeEnclosureBinaryByChannelIdItemId",{channelId:e,itemId:t}).then(function(){return L("system.getEnclosureDocByChannelIdItemId",{channelId:e,itemId:t})}).then(function(e){return e.enclosureDoc.failed?(delete e.enclosureDoc.failed,L("system.addOrUpdateEnclosureDoc",e)):Promise.resolve()}).then(function(){return n._updateState()})}},{key:"requestDownload",value:function(e,t){var n=this;L("system.addOrUpdateEnclosureDoc",{enclosureDoc:{channelId:e,itemId:t}}).then(function(){return L("system.getItemByChannelIdId",{channelId:e,id:t})}).then(function(e){return e.item.triaged=!0,L("system.addOrUpdateItem",{item:e.item})}).then(function(){return n._updateState()})}},{key:"play",value:function(e,t){var n=this;return L("system.getItemByChannelIdId",{channelId:e,id:t}).then(function(e){return L("system.playerService.setItem",{item:e.item})}).then(function(){return L("system.playerService.setPlaying",{playing:!0})}).then(function(){return n._updateState()})}},{key:"toggleTriaged",value:function(e,t){var n=this;return L("system.getItemByChannelIdId",{channelId:e,id:t}).then(function(e){return e.item.triaged?delete e.item.triaged:e.item.triaged=!0,L("system.addOrUpdateItem",{item:e.item})}).then(function(){return n._updateState()})}},{key:"_updateState",value:function(){var e=this;return Promise.all([L("system.getItemsByChannelId",{channelId:this._view.channelId}),L("system.getEnclosureDocsByChannelId",{channelId:this._view.channelId})]).then(function(t){return Promise.all(t[1].enclosureDocs.map(function(e){return L("system.checkEnclosureBinaryExistsByChannelItemId",e)})).then(function(n){e._view.items=t[0].items.sort(function(e,t){return-e.date.localeCompare(t.date)}),e._view.enclosureDocs=t[1].enclosureDocs,e._view.binExists=n})})}},{key:"finalize",value:function(){delete this._view}}]),e}(),te=n(240),ne=n.n(te),se=n(84),ie=n.n(se),ae=n(241),re=n.n(ae),oe=n(151),le=n.n(oe),ce=function(e){function t(){var e,n;Object(o.a)(this,t);for(var s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={openItemId:null,itemTree:null},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"_onNestedListToggle",value:function(e){this.setState({openItemId:e.props.id})}},{key:"componentWillReceiveProps",value:function(e){var t=e.items.reduce(function(e,t){var n=new Date(t.date),s="".concat(n.getMonth()+1);1===s.length&&(s="0".concat(s));var i="".concat(n.getFullYear(),"-").concat(s);return e[i]||(e[i]=[]),e[i].push(t),e},{}),n=Object.keys(t)[0];t[this.state.openItemId]&&(n=this.state.openItemId),this.setState({itemTree:t,openItemId:n})}},{key:"render",value:function(){var e=this,t=i.a.createElement(Y.a,{touch:!0},i.a.createElement(X.a,null)),n=[];return this.state.itemTree&&(n=Object.keys(this.state.itemTree).map(function(n){return i.a.createElement(A.ListItem,{key:n,id:n,secondaryText:n,primaryTogglesNestedList:!0,onNestedListToggle:e._onNestedListToggle.bind(e),open:e.state.openItemId===n,nestedItems:e.state.itemTree[n].map(function(n){var s,a,r,o,l=[{label:"toggle new",onClick:function(){e.props.onToggleNew(n.channelId,n.id)}}],c={margin:4};if(n.currentTime&&(s=i.a.createElement(ie.a,{style:c},"partially played")),n.playCount&&(a=i.a.createElement(ie.a,{style:c},i.a.createElement(le.a,null,n.playCount),"times played")),e.props.enclosureDocs){var u=e.props.enclosureDocs.find(function(e){return e.itemId===n.id&&e.channelId===n.channelId});if(u){var h="requested",d=e.props.binExists.find(function(e){return e.channelId===u.channelId&&e.itemId===u.itemId}),m="undefined"!==typeof d&&d.enclosureBinaryExists;u.failed?(h="failed",l.push({label:"refresh download",onClick:function(){e.props.onRefreshDownload(n.channelId,n.id)}})):m&&(h="available",l.push({label:"refresh download",onClick:function(){e.props.onRefreshDownload(n.channelId,n.id)}}),l.push({label:"play",onClick:function(){e.props.onPlay(n.channelId,n.id)}})),l.push({label:"remove download",onClick:function(){e.props.onRemoveDownload(n.channelId,n.id)}}),r=i.a.createElement(ie.a,{style:c},"download ",h)}else l.push({label:"request download",onClick:function(){e.props.onRequestDownload(n.channelId,n.id)}})}n.triaged||(o=i.a.createElement(ie.a,{style:c},i.a.createElement(le.a,null,i.a.createElement(re.a,null)),"new"));var p=i.a.createElement(W.a,{iconButtonElement:t},l.map(function(e){return i.a.createElement(J.a,{key:e.label,onClick:e.onClick},e.label)}));return i.a.createElement(A.ListItem,{key:n.id,rightIconButton:p,primaryText:i.a.createElement("div",null,n.title,i.a.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},o,s,a,r))})})})})),i.a.createElement(A.List,null,n)}}]),t}(s.Component),ue=function(e){function t(){var e,n;Object(o.a)(this,t);for(var s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={items:[],enclosureDocs:[],binExists:[]},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this._pres=new ee(this)}},{key:"componentWillUnmount",value:function(){this._pres.finalize()}},{key:"_play",value:function(e,t){this._pres.play(e,t)}},{key:"_refreshDownload",value:function(e,t){this._pres.refreshDownload(e,t)}},{key:"_requestDownload",value:function(e,t){this._pres.requestDownload(e,t)}},{key:"_removeDownload",value:function(e,t){this._pres.removeDownload(e,t)}},{key:"_toggleNew",value:function(e,t){this._pres.toggleTriaged(e,t)}},{key:"render",value:function(){var e=this,t=i.a.createElement(Y.a,{touch:!0,onClick:function(){e._pres.goToChannelListPage()}},i.a.createElement(ne.a,null));return i.a.createElement("div",null,i.a.createElement(M.a,{title:"channel",iconElementLeft:t}),i.a.createElement(ce,{items:this.state.items,enclosureDocs:this.state.enclosureDocs,binExists:this.state.binExists,onToggleNew:this._toggleNew.bind(this),onPlay:this._play.bind(this),onRefreshDownloads:this._refreshDownload.bind(this),onRemoveDownload:this._removeDownload.bind(this),onRequestDownload:this._requestDownload.bind(this)}))}},{key:"binExists",set:function(e){this.setState({binExists:e})}},{key:"items",set:function(e){this.setState({items:e})}},{key:"enclosureDocs",set:function(e){this.setState({enclosureDocs:e})}},{key:"channelId",get:function(){return this.props.match.params.channelId}}]),t}(s.Component),he=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function de(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var me=n(242),pe=n.n(me),ye=n(32),fe=n(152),ge=n(67),ve=function(){function e(){Object(o.a)(this,e),this._userPoolId="eu-central-1_jUeKzeHCz",this._clientId="2l07nc0987v932rhiaqrl2c294",I.a.subscribe("system.getIdToken.request",this._getIdToken.bind(this)),I.a.subscribe("system.logout.request",this._logout.bind(this))}return Object(l.a)(e,[{key:"_logout",value:function(e,t){var n=new ge.c({UserPoolId:this._userPoolId,ClientId:this._clientId});n.getCurrentUser()&&n.getCurrentUser().signOut(),I.a.publish("system.logout.response.".concat(e.split(".")[3]))}},{key:"_getCurrentIdToken",value:function(){var e=this;return new Promise(function(t,n){new ge.c({UserPoolId:e._userPoolId,ClientId:e._clientId}).getCurrentUser().getSession(function(e,s){e?n(e):t(s.getIdToken().jwtToken)})})}},{key:"_authenticate",value:function(){var e=this;return L("ui.getCredentials").then(function(t){return new Promise(function(n,s){var i=new ge.a({Username:t.username,Password:t.password}),a=new ge.c({UserPoolId:e._userPoolId,ClientId:e._clientId}),r={Username:t.username,Pool:a},o=new ge.b(r);o.authenticateUser(i,{onSuccess:function(e){n(e.getIdToken().jwtToken)},onFailure:function(e){s(e)},newPasswordRequired:function(e,t){var n=this;L("ui.getNewPassword").then(function(t){delete e.email_verified,o.completeNewPasswordChallenge(t.newPassword,e,n)}).catch(function(e){s(e)})}})})})}},{key:"_getIdToken",value:function(e,t){var n=this;this._currentRequest={topic:e,data:t},this._getCurrentIdToken().catch(function(e){return n._authenticate()}).then(function(e){I.a.publish("system.getIdToken.response.".concat(n._currentRequest.topic.split(".")[3]),{idToken:e})})}}]),e}(),Ie=function(){function e(){Object(o.a)(this,e),I.a.subscribe("ui",this._logMessage.bind(this)),I.a.subscribe("system",this._logMessage.bind(this)),I.a.subscribe("event",this._logMessage.bind(this)),I.a.subscribe("user",this._logMessage.bind(this))}return Object(l.a)(e,[{key:"_logMessage",value:function(e,t){console.log({topic:e,data:t})}}]),e}(),be=n(55),_e=n.n(be),ke=function(){function e(){Object(o.a)(this,e),I.a.subscribe("system.getApiChannels.request",this._getApiChannels.bind(this)),I.a.subscribe("system.getApiChannelById.request",this._getApiChannelById.bind(this)),I.a.subscribe("system.postNewApiChannel.request",this._postNewApiChannel.bind(this)),I.a.subscribe("system.getApiItemsByChannelId.request",this._getApiItemsByChannelId.bind(this)),I.a.subscribe("system.getApiItemBlobByChannelIdId.request",this._getApiItemBlobByChannelIdId.bind(this)),I.a.subscribe("system.getApiItemInfoByChannelIdId.request",this._getApiItemInfoByChannelIdId.bind(this))}return Object(l.a)(e,[{key:"_getApiItemInfoByChannelIdId",value:function(e,t){L("system.getIdToken").then(function(e){return _e.a.head("https://internal.hochreiner.net/rss-json-service/channels/".concat(t.channelId,"/items/").concat(t.id),{headers:{Authorization:"Bearer ".concat(e.idToken),Accept:"audio/mpeg"}})}).then(function(t){t.error?I.a.publish("system.getApiItemInfoByChannelIdId.response.".concat(e.split(".")[3]),{error:t.error}):I.a.publish("system.getApiItemInfoByChannelIdId.response.".concat(e.split(".")[3]),{info:t.headers})}).catch(function(t){I.a.publish("system.getApiItemInfoByChannelIdId.response.".concat(e.split(".")[3]),{error:t})})}},{key:"_getApiItemBlobByChannelIdId",value:function(e,t){L("system.getIdToken").then(function(e){return _e.a.get("https://internal.hochreiner.net/rss-json-service/channels/".concat(t.channelId,"/items/").concat(t.id),{headers:{Authorization:"Bearer ".concat(e.idToken),Accept:"audio/mpeg"},responseType:"blob"})}).then(function(t){t.error?I.a.publish("system.getApiItemBlobByChannelIdId.response.".concat(e.split(".")[3]),{error:t.error}):I.a.publish("system.getApiItemBlobByChannelIdId.response.".concat(e.split(".")[3]),{blob:t.data})}).catch(function(t){I.a.publish("system.getApiItemBlobByChannelIdId.response.".concat(e.split(".")[3]),{error:t})})}},{key:"_getApiItemsByChannelId",value:function(e,t){L("system.getIdToken").then(function(e){return _e.a.get("https://internal.hochreiner.net/rss-json-service/channels/".concat(t.channelId,"/items"),{headers:{Authorization:"Bearer ".concat(e.idToken)}})}).then(function(t){I.a.publish("system.getApiItemsByChannelId.response.".concat(e.split(".")[3]),t.data)})}},{key:"_getApiChannels",value:function(e,t){L("system.getIdToken").then(function(e){return _e.a.get("https://internal.hochreiner.net/rss-json-service/channels",{headers:{Authorization:"Bearer ".concat(e.idToken)}})}).then(function(t){I.a.publish("system.getApiChannels.response.".concat(e.split(".")[3]),t.data)})}},{key:"_getApiChannelById",value:function(e,t){L("system.getIdToken").then(function(e){return _e.a.get("https://internal.hochreiner.net/rss-json-service/channels/".concat(t.id),{headers:{Authorization:"Bearer ".concat(e.idToken)}})}).then(function(t){I.a.publish("system.getApiChannelById.response.".concat(e.split(".")[3]),t.data)})}},{key:"_postNewApiChannel",value:function(e,t){L("system.getIdToken").then(function(e){return _e.a.post("https://internal.hochreiner.net/rss-json-service/channels",{url:t.url},{headers:{Authorization:"Bearer ".concat(e.idToken)}})}).then(function(t){I.a.publish("system.postNewApiChannel.response.".concat(e.split(".")[3]),t.data)})}}]),e}(),Ce=function(){function e(t,n){Object(o.a)(this,e),this._pouch=t,this._ps=n,this._ps.subscribe("system.getAllChannels.request",this.getAllChannels.bind(this)),this._ps.subscribe("system.getChannelById.request",this.getChannelById.bind(this)),this._ps.subscribe("system.getItemsByChannelId.request",this.getItemsByChannelId.bind(this)),this._ps.subscribe("system.getItemByChannelIdId.request",this.getItemByChannelIdId.bind(this)),this._ps.subscribe("system.addOrUpdateChannel.request",this.addOrUpdateChannel.bind(this)),this._ps.subscribe("system.addOrUpdateItem.request",this.addOrUpdateItem.bind(this))}return Object(l.a)(e,[{key:"getAllChannels",value:function(e,t){var n=this,s="system.getAllChannels.response.".concat(e.split(".")[3]);this._pouch.allDocs({include_docs:!0,startkey:"channels/",endkey:"channels/\ufff0"}).then(function(e){n._ps.publish(s,{channels:e.rows.map(function(e){return e.doc})})}).catch(function(e){n._ps.publish(s,{error:e})})}},{key:"getItemsByChannelId",value:function(e,t){var n=this,s="system.getItemsByChannelId.response.".concat(e.split(".")[3]);this._pouch.allDocs({include_docs:!0,startkey:"items/".concat(t.channelId,"/"),endkey:"items/".concat(t.channelId,"/\ufff0")}).then(function(e){n._ps.publish(s,{items:e.rows.map(function(e){return e.doc})})}).catch(function(e){n._ps.publish(s,{error:e})})}},{key:"getItemByChannelIdId",value:function(e,t){var n=this,s="system.getItemByChannelIdId.response.".concat(e.split(".")[3]);this._pouch.get("items/".concat(t.channelId,"/").concat(t.id)).then(function(e){n._ps.publish(s,{item:e})}).catch(function(e){n._ps.publish(s,{error:e})})}},{key:"getChannelById",value:function(e,t){var n=this,s="system.getChannelById.response.".concat(e.split(".")[3]);this._pouch.get("channels/".concat(t.id)).then(function(e){n._ps.publish(s,{channel:e})}).catch(function(e){n._ps.publish(s,{error:e})})}},{key:"addOrUpdateChannel",value:function(e,t){var n=this,s="system.addOrUpdateChannel.response.".concat(e.split(".")[3]),i=t.channel;i._id="channels/".concat(i.id),this._pouch.put(i).then(function(){n._ps.publish(s)}).catch(function(e){n._ps.publish(s,{error:e})})}},{key:"addOrUpdateItem",value:function(e,t){var n=this,s="system.addOrUpdateItem.response.".concat(e.split(".")[3]),i=t.item;i.channelId?(i._id="items/".concat(i.channelId,"/").concat(i.id),this._pouch.put(i).then(function(){n._ps.publish(s)}).catch(function(e){n._ps.publish(s,{error:e})})):this._ps.publish(s,{error:new Error("Item has no channel id.")})}}]),e}();function we(e,t,n){var s=!1;return t.forEach(function(t){n[t]&&JSON.stringify(e[t])!==JSON.stringify(n[t])&&(e[t]=n[t],s=!0)}),s}var Ee=function(){function e(){Object(o.a)(this,e),I.a.subscribe("system.syncChannels.request",this.syncChannels.bind(this))}return Object(l.a)(e,[{key:"syncChannels",value:function(e,t){var n="system.syncChannels.response.".concat(e.split(".")[3]);Promise.all([L("system.getApiChannels"),L("system.getAllChannels")]).then(function(e){var t={},n=e[0].channels,s=e[1].channels;return n.forEach(function(e){t[e.id]=!0}),s.forEach(function(e){t[e.id]=!0}),Promise.all(Object.keys(t).map(function(e){var t=n.find(function(t){return t.id===e}),i=s.find(function(t){return t.id===e});if(t&&i){if(we(i,["title","description","url"],t))return L("system.addOrUpdateChannel",{channel:i}).catch(function(e){I.a.publish("system.log.error",{error:e})})}else{if(t)return L("system.addOrUpdateChannel",{channel:t}).catch(function(e){I.a.publish("system.log.error",{error:e})});if(i)return L("system.postNewApiChannel",{url:i.url}).then(function(){return L("system.getApiChannelById",{id:i.id})}).then(function(e){if(we(i,["title","description","url"],e.channel))return L("system.addOrUpdateChannel",{channel:i})}).catch(function(e){I.a.publish("system.log.error",{error:e})})}}).filter(function(e){return"undefined"!==typeof e}))}).then(function(){return L("system.getAllChannels")}).then(function(e){return Promise.all(e.channels.filter(function(e){return e.selected}).map(function(e){return Promise.all([L("system.getApiItemsByChannelId",{channelId:e.id}),L("system.getItemsByChannelId",{channelId:e.id})]).then(function(t){var n=[],s=t[0].items,i=t[1].items;return s.forEach(function(t){var s=i.find(function(e){return e.id===t.id});s?we(s,["title","date","enclosure"],t)&&n.push(L("system.addOrUpdateItem",{item:s})):(t.channelId=e.id,n.push(L("system.addOrUpdateItem",{item:t})))}),Promise.all(n)})}))}).then(function(){I.a.publish(n,{})}).catch(function(e){I.a.publish(n,{error:e})})}}]),e}(),Te=function(){function e(){Object(o.a)(this,e),I.a.subscribe("system.goToPlayerPage.request",this.goToPlayerPage.bind(this)),I.a.subscribe("system.goToChannelListPage.request",this.goToChannelListPage.bind(this)),I.a.subscribe("system.goToChannelPage.request",this.goToChannelPage.bind(this)),I.a.subscribe("system.goToInfoPage.request",this.goToInfoPage.bind(this))}return Object(l.a)(e,[{key:"goToChannelPage",value:function(e,t){(new ye.a).history.push("/channels/".concat(t.id))}},{key:"goToChannelListPage",value:function(e,t){(new ye.a).history.push("/channels")}},{key:"goToPlayerPage",value:function(e,t){(new ye.a).history.push("/player")}},{key:"goToInfoPage",value:function(e,t){(new ye.a).history.push("/info")}}]),e}(),Se=function(){function e(t,n,s){Object(o.a)(this,e),this._pouch=t,this._ps=n,this._fss=s,this._ps.subscribe("system.getAllEnclosureDocs.request",this.getAllEnclosureDocs.bind(this)),this._ps.subscribe("system.getEnclosureDocsByChannelId.request",this.getEnclosureDocsByChannelId.bind(this)),this._ps.subscribe("system.getEnclosureDocByChannelIdItemId.request",this.getEnclosureDocByChannelIdItemId.bind(this)),this._ps.subscribe("system.removeEnclosureBinaryByChannelIdItemId.request",this.removeEnclosureBinaryByChannelIdItemId.bind(this)),this._ps.subscribe("system.addOrUpdateEnclosureDoc.request",this.addOrUpdateEnclosureDoc.bind(this)),this._ps.subscribe("system.addOrUpdateEnclosureBinary.request",this.addOrUpdateEnclosureBinary.bind(this)),this._ps.subscribe("system.removeEnclosureDocAndBinaryByChannelItemId.request",this.removeEnclosureDocAndBinaryByChannelItemId.bind(this)),this._ps.subscribe("system.checkEnclosureBinaryExistsByChannelItemId.request",this.checkEnclosureBinaryExistsByChannelItemId.bind(this))}return Object(l.a)(e,[{key:"checkEnclosureBinaryExistsByChannelItemId",value:function(e,t){var n=this,s="system.checkEnclosureBinaryExistsByChannelItemId.response.".concat(e.split(".")[3]);return this._fss.getFileSystem().then(function(e){return e.root.getDirectory("enclosures")}).then(function(e){return e.getDirectory(t.channelId)}).then(function(e){return e.getFile(t.itemId)}).then(function(e){n._ps.publish(s,{channelId:t.channelId,itemId:t.itemId,enclosureBinaryExists:!0})}).catch(function(e){n._ps.publish(s,{channelId:t.channelId,itemId:t.itemId,enclosureBinaryExists:!1})})}},{key:"getAllEnclosureDocs",value:function(e,t){var n=this,s="system.getAllEnclosureDocs.response.".concat(e.split(".")[3]);this._pouch.allDocs({include_docs:!0}).then(function(e){n._ps.publish(s,{enclosureDocs:e.rows.map(function(e){return e.doc})})}).catch(function(e){n._ps.publish(s,{error:e})})}},{key:"getEnclosureDocsByChannelId",value:function(e,t){var n=this,s="system.getEnclosureDocsByChannelId.response.".concat(e.split(".")[3]);this._pouch.allDocs({include_docs:!0,startkey:"enclosures/".concat(t.channelId,"/"),endkey:"enclosures/".concat(t.channelId,"/\ufff0")}).then(function(e){n._ps.publish(s,{enclosureDocs:e.rows.map(function(e){return e.doc})})}).catch(function(e){n._ps.publish(s,{error:e})})}},{key:"getEnclosureDocByChannelIdItemId",value:function(e,t){var n=this,s="system.getEnclosureDocByChannelIdItemId.response.".concat(e.split(".")[3]);this._pouch.get("enclosures/".concat(t.channelId,"/").concat(t.itemId)).then(function(e){n._ps.publish(s,{enclosureDoc:e})}).catch(function(e){n._ps.publish(s,{error:e})})}},{key:"addOrUpdateEnclosureDoc",value:function(e,t){var n=this,s="system.addOrUpdateEnclosureDoc.response.".concat(e.split(".")[3]),i=t.enclosureDoc;i._id="enclosures/".concat(i.channelId,"/").concat(i.itemId),this._pouch.put(i).then(function(){n._ps.publish(s)}).catch(function(e){409===e.status?n._ps.publish(s):n._ps.publish(s,{error:e})})}},{key:"addOrUpdateEnclosureBinary",value:function(e,t){var n=this,s="system.addOrUpdateEnclosureBinary.response.".concat(e.split(".")[3]);this._fss.getFileSystem().then(function(e){return e.root.createDirectory("enclosures")}).then(function(e){return e.createDirectory(t.channelId)}).then(function(e){return e.createFile(t.itemId)}).then(function(e){return e.write(t.enclosure)}).then(function(){n._ps.publish(s)}).catch(function(e){n._ps.publish(s,{error:e})})}},{key:"_removeEnclosureBinaryByChannelIdItemId",value:function(e,t){return this._fss.getFileSystem().then(function(e){return e.root.getDirectory("enclosures")}).then(function(t){return t.getDirectory(e)}).then(function(e){return e.getFile(t)}).then(function(e){return e.remove()})}},{key:"removeEnclosureBinaryByChannelIdItemId",value:function(e,t){var n=this,s="system.removeEnclosureBinaryByChannelIdItemId.response.".concat(e.split(".")[3]);this._removeEnclosureBinaryByChannelIdItemId(t.channelId,t.itemId).then(function(){n._ps.publish(s)}).catch(function(e){n._ps.publish(s,{error:e})})}},{key:"removeEnclosureDocAndBinaryByChannelItemId",value:function(e,t){var n=this,s="system.removeEnclosureDocAndBinaryByChannelItemId.response.".concat(e.split(".")[3]);this._pouch.get("enclosures/".concat(t.channelId,"/").concat(t.itemId)).then(function(e){return n._pouch.remove(e)}).then(function(){return n._removeEnclosureBinaryByChannelIdItemId(t.channelId,t.itemId)}).then(function(){n._ps.publish(s)}).catch(function(e){n._ps.publish(s,{error:e})})}}]),e}(),Oe=function(){function e(t,n,s){Object(o.a)(this,e),this.ps=t,this.nt=n,this.fss=s,this.currentlyRunning=!1,setInterval(this.tick.bind(this),3e4)}return Object(l.a)(e,[{key:"tick",value:function(){var e=this;this.currentlyRunning||this.nt.shouldAccessNetwork&&(this.currentlyRunning=!0,this.ps.prom("system.getAllEnclosureDocs").then(function(t){var n=t.enclosureDocs.filter(function(e){return!e.failed});return Promise.all(n.map(function(t){return e.ps.prom("system.checkEnclosureBinaryExistsByChannelItemId",t)})).then(function(t){if(0!==(n=n.filter(function(e,n){return!t[n].enclosureBinaryExists})).length)return Promise.all([e.ps.prom("system.getApiItemInfoByChannelIdId",{channelId:n[0].channelId,id:n[0].itemId}),e.fss.queryUsageAndQuota()]).then(function(t){var n=parseInt(t[0].info["content-length"],10)+t[1].usage;return n<t[1].quota?Promise.resolve():e.fss.requestQuota(Math.max(Math.round(1.2*n),1073741824)).then(function(e){return n<e.quota?Promise.resolve():Promise.failed(new Error("not enough space"))})}).then(function(){return e.ps.prom("system.getApiItemBlobByChannelIdId",{channelId:n[0].channelId,id:n[0].itemId})}).then(function(t){return e.ps.prom("system.addOrUpdateEnclosureBinary",{channelId:n[0].channelId,itemId:n[0].itemId,enclosure:t.blob})}).then(function(){return e.ps.prom("system.getEnclosureDocByChannelIdItemId",{channelId:n[0].channelId,itemId:n[0].itemId}).then(function(t){return t.enclosureDoc.failed?(delete t.enclosureDoc.failed,e.ps.prom("system.addOrUpdateEnclosureDoc",t)):Promise.resolve()})}).catch(function(t){return e.ps.prom("system.getEnclosureDocByChannelIdItemId",{channelId:n[0].channelId,itemId:n[0].itemId}).then(function(t){return t.enclosureDoc.failed=!0,e.ps.prom("system.addOrUpdateEnclosureDoc",t)})})})}).then(function(){var t=e.lastSync;return e.lastSync=(new Date).toISOString().substr(0,10),t!==e.lastSync?e.ps.prom("system.syncChannels"):Promise.resolve()}).then(function(){e.currentlyRunning=!1}).catch(function(t){e.currentlyRunning=!1}))}}]),e}(),Be=function(){function e(t){Object(o.a)(this,e),this._view=t,this._statusToken=I.a.subscribe("system.playerService.statusChanged",this._handleStatusChange.bind(this)),this._updateCurrentState().catch(function(e){I.a.publish("user.notification.showError",{error:e})})}return Object(l.a)(e,[{key:"_updateCurrentState",value:function(){var e=this;return L("system.playerService.getStatus").then(function(t){e._handleStatusChange(null,t)})}},{key:"refreshEnclosure",value:function(e){var t=this;return L("system.removeEnclosureBinaryByChannelIdItemId",{channelId:e.channelId,itemId:e.id}).then(function(){return L("system.playerService.getStatus")}).then(function(e){t._handleStatusChange(null,e)})}},{key:"deleteEnclosure",value:function(e){var t=this;return L("system.removeEnclosureDocAndBinaryByChannelItemId",{channelId:e.channelId,itemId:e.id}).then(function(){return L("system.playerService.getStatus")}).then(function(e){t._handleStatusChange(null,e)})}},{key:"goToChannelListPage",value:function(){I.a.publish("system.goToChannelListPage.request")}},{key:"goToInfoPage",value:function(){I.a.publish("system.goToInfoPage.request")}},{key:"selectedItemChanged",value:function(e){var t=this;return L("system.playerService.setItem",{item:e}).then(function(){return t._updateCurrentState()}).catch(function(e){var t="error loading item";e.message&&(t=e.message),I.a.publish("user.notification.showError",{error:{message:t}})})}},{key:"volumeChanged",value:function(e){L("system.playerService.setVolume",{volume:e})}},{key:"speedChanged",value:function(e){L("system.playerService.setSpeed",{speed:e})}},{key:"currentTimeChanged",value:function(e){L("system.playerService.setCurrentTime",{currentTime:e})}},{key:"start",value:function(){var e=this;return L("system.playerService.setPlaying",{playing:!0}).then(function(){e._view.playing=!0,e._intervalCancelToken||(e._intervalCancelToken=setInterval(e._updateCurrentTime.bind(e),1e3))})}},{key:"stop",value:function(){var e=this,t=this._intervalCancelToken;return delete this._intervalCancelToken,clearInterval(t),L("system.playerService.setPlaying",{playing:!1}).then(function(t){e._view.playing=!1})}},{key:"_updateCurrentTime",value:function(){var e=this;L("system.playerService.getCurrentTime").then(function(t){e._view.currentTime=t.currentTime})}},{key:"_handleStatusChange",value:function(e,t){if(this._view.playing=t.status.playing,this._view.selectedItem=t.status.item,this._view.duration=t.status.duration,this._view.currentTime=t.status.currentTime,this._view.volume=t.status.volume,this._view.speed=t.status.speed,this._view.items=t.status.playlist,this._intervalCancelToken&&!t.status.playing){var n=this._intervalCancelToken;delete this._intervalCancelToken,clearInterval(n)}!this._intervalCancelToken&&t.status.playing&&(this._intervalCancelToken=setInterval(this._updateCurrentTime.bind(this),1e3))}},{key:"finalize",value:function(){I.a.unsubscribe(this._statusToken),this._intervalCancelToken&&clearInterval(this._intervalCancelToken)}}]),e}(),Pe=n(155),De=n(249),je=n.n(De),Ae=n(250),Ue=n.n(Ae),qe=n(251),Fe=n.n(qe),xe=n(252),Le=n.n(xe),Ne=n(253),Re=n.n(Ne),ze=n(254),Me=n.n(ze),Qe=n(102),We=n.n(Qe),Ve=(n(596),function(e){function t(){var e,n;Object(o.a)(this,t);for(var s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={items:[],selectedItem:null,playing:!1,volume:.5,speed:1,currentTime:0,duration:0},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this._pres=new Be(this)}},{key:"componentWillUnmount",value:function(){this._pres.finalize()}},{key:"_handleListItemClick",value:function(e){this._pres.selectedItemChanged(e)}},{key:"_handleVolumeChange",value:function(e,t){this.setState({volume:t}),this._pres.volumeChanged(t)}},{key:"_handleSpeedChange",value:function(e,t){this.setState({speed:t}),this._pres.speedChanged(t)}},{key:"_handleCurrentTimeChange",value:function(e,t){this.setState({currentTime:t}),this._pres.currentTimeChanged(t)}},{key:"_handleEnclosureRefresh",value:function(e,t){this._pres.refreshEnclosure(e)}},{key:"_handleEnclosureDelete",value:function(e,t){this._pres.deleteEnclosure(e)}},{key:"_formatTime",value:function(e){var t="".concat(Math.round(e%60)),n="".concat(Math.floor(e/60));return 1===t.length&&(t="0"+t),1===n.length&&(n="0"+n),"".concat(n,":").concat(t)}},{key:"render",value:function(){var e=this,t=i.a.createElement(W.a,{iconButtonElement:i.a.createElement(Y.a,null,i.a.createElement(K.a,{color:"#FFF"})),anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"}},i.a.createElement(J.a,{primaryText:"channels",onClick:function(){e._pres.goToChannelListPage()}}),i.a.createElement(J.a,{primaryText:"info",onClick:function(){e._pres.goToInfoPage()}})),n=function(t){return i.a.createElement(W.a,{iconButtonElement:i.a.createElement(Y.a,null,i.a.createElement(X.a,null)),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"}},i.a.createElement(J.a,{primaryText:"refresh",onClick:e._handleEnclosureRefresh.bind(e,t)}),i.a.createElement(J.a,{primaryText:"delete",onClick:e._handleEnclosureDelete.bind(e,t)}))},s=i.a.createElement(Y.a,{disabled:!this.state.selectedItem||this.state.playing,onClick:function(){e._pres.start()}},i.a.createElement(Re.a,null)),a=i.a.createElement(Y.a,{disabled:!this.state.selectedItem||!this.state.playing,onClick:function(){e._pres.stop()}},i.a.createElement(Me.a,null)),r=this.state.playing?a:s;return i.a.createElement("div",null,i.a.createElement(M.a,{title:"player",iconElementLeft:t}),i.a.createElement(Pe.Toolbar,null,i.a.createElement(Pe.ToolbarGroup,{firstChild:!0},r,this.state.selectedItem?this.state.selectedItem.title:"")),i.a.createElement("div",{className:"sliderGroup"},i.a.createElement("table",null,i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,this._formatTime(this.state.currentTime)),i.a.createElement("td",{className:"sliderColumn"},i.a.createElement(We.a,{min:0,max:this.state.duration,step:1,value:this.state.currentTime,onChange:this._handleCurrentTimeChange.bind(this)})),i.a.createElement("td",null,this._formatTime(this.state.duration))),i.a.createElement("tr",null,i.a.createElement("td",null,i.a.createElement(Le.a,null)),i.a.createElement("td",{className:"sliderColumn"},i.a.createElement(We.a,{min:0,max:1,step:.01,value:this.state.volume,onChange:this._handleVolumeChange.bind(this)})),i.a.createElement("td",null,i.a.createElement(Fe.a,null))),i.a.createElement("tr",null,i.a.createElement("td",null,i.a.createElement(Ue.a,null)),i.a.createElement("td",{className:"sliderColumn"},i.a.createElement(We.a,{min:.5,max:2,step:.05,value:this.state.speed,onChange:this._handleSpeedChange.bind(this)})),i.a.createElement("td",null,i.a.createElement(je.a,null)))))),i.a.createElement(A.List,null,this.state.items.map(function(t){return i.a.createElement(A.ListItem,{key:t.id,primaryText:t.title,onClick:e._handleListItemClick.bind(e,t),rightIconButton:n(t)})})))}},{key:"items",set:function(e){this.setState({items:e})}},{key:"selectedItem",set:function(e){this.setState({selectedItem:e})}},{key:"playing",set:function(e){this.setState({playing:e})}},{key:"volume",set:function(e){this.setState({volume:e})}},{key:"speed",set:function(e){this.setState({speed:e})}},{key:"currentTime",get:function(){return this.state.currentTime},set:function(e){this.setState({currentTime:e})}},{key:"duration",set:function(e){this.setState({duration:e})}}]),t}(s.Component)),Je=function(){function e(t,n){var s=this;Object(o.a)(this,e),this.ps=t,this.fss=n,this.audio=new Audio,this._handlePlayFun=this._handlePlay.bind(this),this._handlePauseFun=this._handlePause.bind(this),this.audio.addEventListener("play",this._handlePlayFun),this.ps.reg("system.playerService.getStatus",this.getStatus.bind(this)),this.ps.reg("system.playerService.setItem",this.setItem.bind(this)),this.ps.reg("system.playerService.getItem",this.getItem.bind(this)),this.ps.reg("system.playerService.setSpeed",this.setSpeed.bind(this)),this.ps.reg("system.playerService.getSpeed",this.getSpeed.bind(this)),this.ps.reg("system.playerService.setVolume",this.setVolume.bind(this)),this.ps.reg("system.playerService.getVolume",this.getVolume.bind(this)),this.ps.reg("system.playerService.setPlaying",this.setPlaying.bind(this)),this.ps.reg("system.playerService.getPlaying",this.getPlaying.bind(this)),this.ps.reg("system.playerService.setCurrentTime",this.setCurrentTime.bind(this)),this.ps.reg("system.playerService.getCurrentTime",this.getCurrentTime.bind(this)),this.ps.reg("system.playerService.getDuration",this.getDuration.bind(this)),this.ps.reg("system.playerService.getPlaylist",this.getPlaylist.bind(this)),this.getPlaylist().then(function(e){if(0!==e.playlist.length)return s.setItem(null,null,null,null,{item:e.playlist[0]}).then(function(){s.ps.pub("system.playerService.statusChanged",{status:{playlist:e.playlist,item:e.playlist[0],playing:!s.audio.paused,speed:s.audio.playbackRate,volume:s.audio.volume,currentTime:s.audio.currentTime,duration:s.audio.duration}})})})}return Object(l.a)(e,[{key:"_handleCurrentTimeUpdate",value:function(){return this._updateCurrentTimeForItem(this.audio.currentTime,this.item)}},{key:"_handlePause",value:function(){var e=this;if(this.audio.removeEventListener("pause",this._handlePauseFun),this.currentTimeIntervalId&&clearInterval(this.currentTimeIntervalId),!this.audio.ended)return this._updateCurrentTimeForItem(this.audio.currentTime,this.item).then(function(){return e.getStatus()}).then(function(t){e.ps.pub("system.playerService.statusChanged",t),e.audio.addEventListener("play",e._handlePlayFun)});var t={};return this.ps.prom("system.getItemByChannelIdId",{id:this.item.id,channelId:this.item.channelId}).then(function(t){var n=t.item;return delete n.currentTime,n.playCount?n.playCount+=1:n.playCount=1,e.ps.prom("system.addOrUpdateItem",{item:n})}).then(function(){return e.getPlaylist()}).then(function(n){return t.playlist=n.playlist,t.item=n.playlist[0],e.setItem(null,null,null,null,{item:n.playlist[0]})}).then(function(){return e.setPlaying(null,null,null,null,{playing:!0})}).then(function(){t.playing=!e.audio.paused,t.speed=e.audio.playbackRate,t.volume=e.audio.volume,t.currentTime=e.audio.currentTime,t.duration=e.audio.duration,e.ps.pub("system.playerService.statusChanged",{status:t})})}},{key:"_handlePlay",value:function(){var e=this;return this.audio.removeEventListener("play",this._handlePlayFun),this.audio.addEventListener("pause",this._handlePauseFun),this.currentTimeIntervalId||(this.currentTimeIntervalId=setInterval(this._handleCurrentTimeUpdate.bind(this),3e3)),this.getStatus().then(function(t){e.ps.pub("system.playerService.statusChanged",t)})}},{key:"getStatus",value:function(e,t,n,s,i){var a=this;return this.getPlaylist().then(function(e){return{status:{item:a.item,speed:a.audio.playbackRate,volume:a.audio.volume,playing:!a.audio.paused,currentTime:a.audio.currentTime,duration:a.audio.duration,playlist:e.playlist}}})}},{key:"getPlaylist",value:function(e,t,n,s,i){var a=this;return this.ps.prom("system.getAllEnclosureDocs").then(function(e){return Promise.all(e.enclosureDocs.map(function(e){return a.ps.prom("system.checkEnclosureBinaryExistsByChannelItemId",{channelId:e.channelId,itemId:e.itemId})})).then(function(t){return Promise.all(e.enclosureDocs.filter(function(e,n){return t[n].enclosureBinaryExists}).map(function(e){return a.ps.prom("system.getItemByChannelIdId",{channelId:e.channelId,id:e.itemId})}))})}).then(function(e){return{playlist:e.map(function(e){return e.item}).filter(function(e){return"undefined"===typeof e.playCount}).sort(function(e,t){return e.date.localeCompare(t.date)})}})}},{key:"_setSource",value:function(e){var t=this;return new Promise(function(n,s){var i=function e(){t.audio.removeEventListener("canplaythrough",e),t.audio.removeEventListener("error",a),n()},a=function e(n){t.audio.removeEventListener("canplaythrough",i),t.audio.removeEventListener("error",e),s(n)};t.audio.addEventListener("canplaythrough",i),t.audio.addEventListener("error",a),t.audio.src=e})}},{key:"setItem",value:function(e,t,n,s,i){var a=this;return this.item=i.item,Promise.all([this.ps.prom("system.getItemByChannelIdId",{id:this.item.id,channelId:this.item.channelId}),this.fss.getFileSystem().then(function(e){return e.root.getDirectory("enclosures")}).then(function(e){return e.getDirectory(a.item.channelId)}).then(function(e){return e.getFile(a.item.id)}),this.ps.prom("system.getChannelById",{id:this.item.channelId})]).then(function(e){return a.item=e[0].item,a._setSource(e[1].URL).then(function(){var t=e[2].channel;a.audio.currentTime=a.item.currentTime||0,a.audio.volume=t.volume||.5,a.audio.playbackRate=t.speed||1})})}},{key:"getItem",value:function(e,t,n,s,i){return{item:this.item}}},{key:"setSpeed",value:function(e,t,n,s,i){this.audio.playbackRate=i.speed;var a=this.delayedSpeedTimeoutId;a&&clearTimeout(a),this.delayedSpeedTimeoutId=setTimeout(this._delayedSpeedUpdate.bind(this),1500)}},{key:"_delayedSpeedUpdate",value:function(){var e=this;delete this.delayedSpeedTimeoutId;var t=this.audio.playbackRate,n=this.item;if(n&&t)return this.ps.prom("system.getChannelById",{id:n.channelId}).then(function(n){var s=n.channel;return s.speed=t,e.ps.prom("system.addOrUpdateChannel",{channel:s})})}},{key:"getSpeed",value:function(e,t,n,s,i){return{speed:this.audio.playbackRate}}},{key:"setVolume",value:function(e,t,n,s,i){this.audio.volume=i.volume;var a=this.delayedVolumeTimeoutId;a&&clearTimeout(a),this.delayedVolumeTimeoutId=setTimeout(this._delayedVolumeUpdate.bind(this),1500)}},{key:"_delayedVolumeUpdate",value:function(){var e=this;delete this.delayedVolumeTimeoutId;var t=this.audio.volume,n=this.item;if(n&&t)return this.ps.prom("system.getChannelById",{id:n.channelId}).then(function(n){var s=n.channel;return s.volume=t,e.ps.prom("system.addOrUpdateChannel",{channel:s})})}},{key:"getVolume",value:function(e,t,n,s,i){return{volume:this.audio.volume}}},{key:"setPlaying",value:function(e,t,n,s,i){return this.item?i.playing?(this.audio.removeEventListener("play",this._handlePlayFun),this.audio.play(),this._handlePlay()):(this.audio.removeEventListener("pause",this._handlePauseFun),this.audio.pause(),this._handlePause()):Promise.reject(new Error("No item set for playing."))}},{key:"_updateCurrentTimeForItem",value:function(e,t){var n=this;return this.ps.prom("system.getItemByChannelIdId",{id:t.id,channelId:t.channelId}).then(function(t){var s=t.item;return s.currentTime=e,n.ps.prom("system.addOrUpdateItem",{item:s})})}},{key:"getPlaying",value:function(e,t,n,s,i){return{playing:!this.audio.paued}}},{key:"setCurrentTime",value:function(e,t,n,s,i){this.audio.currentTime=i.currentTime;var a=this.delayedCurrentTimeTimeoutId;a&&clearTimeout(a),this.delayedCurrentTimeTimeoutId=setTimeout(this._delayedCurrentTimeUpdate.bind(this),1500)}},{key:"_delayedCurrentTimeUpdate",value:function(){delete this.delayedCurrentTimeTimeoutId;var e=this.audio.currentTime,t=this.item;t&&e&&this._updateCurrentTimeForItem(e,t)}},{key:"getCurrentTime",value:function(e,t,n,s,i){return{currentTime:this.audio.currentTime}}},{key:"getDuration",value:function(e,t,n,s,i){return{duration:this.audio.duration}}}]),e}(),Ge=function(){function e(t){var n=this;Object(o.a)(this,e),this._view=t,this._view.networkSaveData=e.NetworkTest.saveData,this._view.networkType=e.NetworkTest.type,this._view.networkAccess=e.NetworkTest.shouldAccessNetwork,e.fssTemp.queryUsageAndQuota().then(function(e){n._view.tempUsage=e.usage,n._view.tempQuota=e.quota}),e.fssPers.queryUsageAndQuota().then(function(e){n._view.persUsage=e.usage,n._view.persQuota=e.quota})}return Object(l.a)(e,[{key:"logout",value:function(){e.ps.pub("system.logout.request")}},{key:"goToPlayerPage",value:function(){e.ps.pub("system.goToPlayerPage.request")}},{key:"goToChannelListPage",value:function(){e.ps.pub("system.goToChannelListPage.request")}},{key:"finalize",value:function(){delete this._view}}]),e}(),Ye=n(257),He=function(){function e(){Object(o.a)(this,e)}return Object(l.a)(e,null,[{key:"pub",value:function(t,n){e.ps.publish(t,n)}},{key:"sub",value:function(t,n){return e.ps.subscribe(t,n)}},{key:"unsub",value:function(t){e.ps.unsubscribe(t)}},{key:"prom",value:function(t,n){return new Promise(e._promisedPubSub.bind(null,t,n))}},{key:"reg",value:function(t,n){return e.sub("".concat(t,".request"),function(t,s){var i=t.split("."),a=Object(Ye.a)(i,5),r=a[0],o=a[1],l=a[2],c=(a[3],a[4]),u="".concat(r,".").concat(o,".").concat(l,".response.").concat(c);try{var h=n(r,o,l,c,s);if(h&&"function"===typeof h.then)return void h.catch(function(e){return{error:e}}).then(function(t){e.pub(u,t)});e.pub(u,h)}catch(d){e.pub(u,{error:d})}})}},{key:"_promisedPubSub",value:function(t,n,s,i){var a=e.uuid(),r=e.sub("".concat(t,".response.").concat(a),function(t,n){e.unsub(r),n&&n.error?i(n.error):s(n)});e.pub("".concat(t,".request.").concat(a),n)}}]),e}(),Ke=n(255),$e=n.n(Ke),Xe=n(256),Ze=n.n(Xe),et=function(e){function t(){var e,n;Object(o.a)(this,t);for(var s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={networkAccess:!1,networkType:"",networkSaveData:"",tempUsage:NaN,tempQuota:NaN,persUsage:NaN,persQuota:NaN},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this._pres=new Ge(this)}},{key:"componentWillUnmount",value:function(){this._pres.finalize(),delete this._pres}},{key:"_handleLogout",value:function(){this._pres.logout()}},{key:"render",value:function(){var e=this,t=i.a.createElement(W.a,{iconButtonElement:i.a.createElement(Y.a,null,i.a.createElement(K.a,{color:"#FFF"})),anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"}},i.a.createElement(J.a,{primaryText:"player",onClick:function(){e._pres.goToPlayerPage()}}),i.a.createElement(J.a,{primaryText:"channels",onClick:function(){e._pres.goToChannelListPage()}})),n=this.state.networkAccess?i.a.createElement($e.a,null):i.a.createElement(Ze.a,null),s="Type: ".concat(this.state.networkType),a="Save data: ".concat(this.state.networkSaveData),r="Network access policy: ".concat(this.state.networkAccess?"access":"do not access"),o="Info storage usage ".concat(Math.round(this.state.tempUsage/this.state.tempQuota*100),"%"),l="".concat(Math.round(this.state.tempUsage/1048576)," MB of ").concat(Math.round(this.state.tempQuota/1048576)," MB used"),c="Download storage usage ".concat(Math.round(this.state.persUsage/this.state.persQuota*100),"%"),u="".concat(Math.round(this.state.persUsage/1048576)," MB of ").concat(Math.round(this.state.persQuota/1048576)," MB used");return i.a.createElement("div",null,i.a.createElement(M.a,{title:"info",iconElementLeft:t}),i.a.createElement("p",null,this.state.info),i.a.createElement(A.List,null,i.a.createElement(A.ListItem,{primaryText:"Network access policy",leftIcon:n,nestedItems:[i.a.createElement(A.ListItem,{key:1,primaryText:s}),i.a.createElement(A.ListItem,{key:2,primaryText:a}),i.a.createElement(A.ListItem,{key:3,primaryText:r})]}),i.a.createElement(A.ListItem,{primaryText:o,secondaryText:l}),i.a.createElement(A.ListItem,{primaryText:c,secondaryText:u})),i.a.createElement("button",{onClick:this._handleLogout.bind(this)},"logout"))}},{key:"tempUsage",set:function(e){this.setState({tempUsage:e})}},{key:"tempQuota",set:function(e){this.setState({tempQuota:e})}},{key:"persUsage",set:function(e){this.setState({persUsage:e})}},{key:"persQuota",set:function(e){this.setState({persQuota:e})}},{key:"fileSystemSize",set:function(e){this.setState({fileSystemSize:e})}},{key:"storageInfo",set:function(e){this.setState({storageInfo:e})}},{key:"networkType",set:function(e){this.setState({networkType:e})}},{key:"networkSaveData",set:function(e){this.setState({networkSaveData:e})}},{key:"networkAccess",set:function(e){this.setState({networkAccess:e})}}]),t}(s.Component),tt=function(){function e(){Object(o.a)(this,e)}return Object(l.a)(e,null,[{key:"shouldAccessNetwork",get:function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t="undefined"!==typeof e.type&&!("ethernet"===e.type||"wifi"===e.type),n="undefined"!==typeof e.saveData&&e.saveData;return!(e&&(t||n))}},{key:"type",get:function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e&&e.type?e.type:""}},{key:"saveData",get:function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return!(!e||!e.saveData)&&e.saveData}}]),e}(),nt=function(){function e(t){Object(o.a)(this,e),this._fsFileEntry=t}return Object(l.a)(e,[{key:"remove",value:function(){var e=this;return new Promise(function(t,n){e._fsFileEntry.remove(function(){t()},function(e){n(e)})})}},{key:"write",value:function(e){var t=this;return new Promise(function(n,s){t._fsFileEntry.createWriter(function(t){t.onwriteend=function(){n()},t.onerror=function(e){s(e)},t.write(e)},function(e){s(e)})})}},{key:"name",get:function(){return this._fsFileEntry.name}},{key:"fullPath",get:function(){return this._fsFileEntry.fullPath}},{key:"isFile",get:function(){return this._fsFileEntry.isFile}},{key:"isDirectory",get:function(){return this._fsFileEntry.isDirectory}},{key:"URL",get:function(){return this._fsFileEntry.toURL()}}]),e}(),st=function(){function e(t){Object(o.a)(this,e),this._fsDirectoryEntry=t}return Object(l.a)(e,[{key:"remove",value:function(){var e=this;return new Promise(function(t,n){e._fsDirectoryEntry.remove(function(){t()},function(e){n(e)})})}},{key:"readDirectory",value:function(t){var n=this;return new Promise(function(t,s){var i=n._fsDirectoryEntry.createReader(),a=[];!function n(){i.readEntries(function(i){i.length?(a=a.concat(i),n()):t(a.map(function(t){return t.isDirectory?new e(t):t.isFile?new nt(t):void s(new Error("unexpected directory entry"))}))},function(e){s(e)})}()})}},{key:"_getDirectory",value:function(t,n){var s=this;return new Promise(function(i,a){s._fsDirectoryEntry.getDirectory(t,n,function(t){i(new e(t))},function(e){a(e)})})}},{key:"getDirectory",value:function(e){return this._getDirectory(e,{create:!1})}},{key:"createDirectory",value:function(e){return this._getDirectory(e,{create:!0})}},{key:"_getFile",value:function(e,t){var n=this;return new Promise(function(s,i){n._fsDirectoryEntry.getFile(e,t,function(e){s(new nt(e))},function(e){i(e)})})}},{key:"getFile",value:function(e){return this._getFile(e,{create:!1})}},{key:"createFile",value:function(e){return this._getFile(e,{create:!0})}},{key:"name",get:function(){return this._fsDirectoryEntry.name}},{key:"fullPath",get:function(){return this._fsDirectoryEntry.fullPath}},{key:"isFile",get:function(){return this._fsDirectoryEntry.isFile}},{key:"isDirectory",get:function(){return this._fsDirectoryEntry.isDirectory}}]),e}(),it=function(){function e(t){Object(o.a)(this,e),this._fsFileSystem=t}return Object(l.a)(e,[{key:"root",get:function(){return new st(this._fsFileSystem.root)}},{key:"name",get:function(){return this._fsFileSystem.name}}]),e}(),at=function(){function e(t,n){Object(o.a)(this,e),this._storageInfo=t,this._requestFileSystem=n}return Object(l.a)(e,[{key:"getFile",value:function(e,t,n){return new Promise(function(n,s){e.getFile(t,{create:!0},function(e){n(e)},function(e){s(e)})})}},{key:"getFileSystem",value:function(){var e=this;return this.queryUsageAndQuota().then(function(t){return new Promise(function(n,s){e._requestFileSystem(t.quota,function(e){n(new it(e))},function(e){s(e)})})})}},{key:"requestQuota",value:function(e){var t=this;return new Promise(function(n,s){t._storageInfo.requestQuota(e,function(e){n({quota:e})},function(e){s(e)})})}},{key:"queryUsageAndQuota",value:function(){var e=this;return new Promise(function(t,n){e._storageInfo.queryUsageAndQuota(function(e,n){t({usage:e,quota:n})},function(e){n(e)})})}}]),e}();var rt,ot=new fe.a("more-podcasts_channelRepository",{storage:"persistent"}),lt=new fe.a("more-podcasts_enclosureRepository",{storage:"persistent"}),ct=new at(navigator.webkitPersistentStorage,window.webkitRequestFileSystem.bind(window,window.PERSISTENT)),ut=new at(navigator.webkitTemporaryStorage,window.webkitRequestFileSystem.bind(window,window.TEMPORARY));He.ps=I.a,He.uuid=x.a,w.ps=He,Ge.ps=He,Ge.fssPers=ct,Ge.fssTemp=ut,new Ce(ot,I.a),new Se(lt,I.a,ct),new ve,new Ie,new ke,new Ee,new Te,new Oe(He,tt,ct),new Je(He,ct),Ge.NetworkTest=tt,pe()(),r.a.render(i.a.createElement(ye.a,null,i.a.createElement(j,null,i.a.createElement(ye.c,null,i.a.createElement(ye.b,{exact:!0,path:"/",component:Ve}),i.a.createElement(ye.b,{exact:!0,path:"/channels",component:Z}),i.a.createElement(ye.b,{exact:!0,path:"/channels/:channelId",component:ue}),i.a.createElement(ye.b,{exact:!0,path:"/player",component:Ve}),i.a.createElement(ye.b,{exact:!0,path:"/info",component:et})))),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/more-podcasts",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/more-podcasts","/service-worker.js");he?function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):de(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e):de(e)})}}(),(rt=lt).allDocs({include_docs:!0}).then(function(e){return Promise.all(e.rows.map(function(e){return e.doc._attachments?Promise.all(Object.keys(e.doc._attachments).map(function(t){return rt.removeAttachment(e.doc._id,t,e.doc._rev)})):Promise.resolve()}))}).then(function(){return rt.compact()}).catch(function(e){console.log(e)})}},[[258,1,2]]]);
//# sourceMappingURL=main.d3181c39.chunk.js.map